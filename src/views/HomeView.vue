<template lang="">
  <div>
    <table>
      <thead>
        <tr>
          <th colspan="1">Nom & prénom</th>
          <th colspan="2">Lundi</th>
          <th colspan="2">Mardi</th>
          <th colspan="2">Mercredi</th>
          <th colspan="2">Jeudi</th>
          <th colspan="2">Vendredi</th>
        </tr>
        <tr>
          <th colspan="1"></th>
          <th colspan="1">AM</th>
          <th colspan="1">PM</th>
          <th colspan="1">AM</th>
          <th colspan="1">PM</th>
          <th colspan="1">AM</th>
          <th colspan="1">PM</th>
          <th colspan="1">AM</th>
          <th colspan="1">PM</th>
          <th colspan="1">AM</th>
          <th colspan="1">PM</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>nom 1</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 2</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 3</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 4</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 5</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 6</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 7</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 8</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 9</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 10</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 11</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 12</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 13</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>
        <tr>
          <td>nom 14</td>
          <td class="lundiAm"></td>
          <td class="lundiPm"></td>
          <td class="mardiAm"></td>
          <td class="mardiPm"></td>
          <td class="mercrediAm"></td>
          <td class="mercrediPm"></td>
          <td class="jeudiAm"></td>
          <td class="jeudiPm"></td>
          <td class="vendrediAm"></td>
          <td class="vendrediPm"></td>
        </tr>

      </tbody>
    </table>
    
    <div style="display:flex">
      <button @click="generatePlanning()"> généré un planning aléatoire</button>
      <button @click="deletePlanning()">supprimer le planning</button>
      <button @click="downloadsTable()">télécharger le tableau</button>
      <button @click="saveRules()">enregistrer les règles</button>
    </div>
    <div class="container">

      <div class="row">

        <div class="col">
          <rules :rulesList="addTaskRules" @deleteRule2="deleteRule"/>
      
          <button @click="displayForm()">ajouter une tâches</button>
         
        </div>
        <div class="col">
          <from>
            <addTask @eventname="updateparent" @deleteform="displayForm" v-if="this.formActive == true" />
          </from>
        </div>
       
      </div>
    </div>
  </div>
</template>
<script>
import addTask from "./addtask.vue"
import rules from "./rules.vue"

export default {
  name: 'HomeView',
  components: {
    addTask,
    rules
  },
  data() {
    return {
      taskNbr: 4,
      formActive: false,
      addTaskRules: [],
      planningDays: {
        lundiAm: [],
        lundiPm: [],
        mardiAm: [],
        mardiPm: [],
        mercrediAm: [],
        mercrediPm: [],
        jeudiAm: [],
        jeudiPm: [],
        vendrediAm: [],
        vendrediPm: []
      },
      planningColors: {
        lundiAm: [],
        lundiPm: [],
        mardiAm: [],
        mardiPm: [],
        mercrediAm: [],
        mercrediPm: [],
        jeudiAm: [],
        jeudiPm: [],
        vendrediAm: [],
        vendrediPm: []
      },
      planningColors2:{
      lundiAm: [[], [], [], [], [], [], [], 'fixe', [], [], [], [], [], 'fixe'],
        lundiPm: [[], [], [], [], [], [], [], 'fixe', [], [], [], [], [], 'fixe'],
        mardiAm: [[], [], [], [], [], [], [], [], [], 'fixe', [], [], [], 'fixe'],
        mardiPm: [[], [], [], [], [], [], [], [], [], 'fixe', [], [], [], 'fixe'],
        mercrediAm: [[], [], [], 'fixe', [], 'fixe', 'fixe', [], [], [], [], 'fixe'],
        mercrediPm: [[], [], [], 'fixe', [], 'fixe', 'fixe', [], [], [], [], 'fixe'],
        jeudiAm: [[], [], [], [], [], [], [], [], [], [], [], [], [],  []],
        jeudiPm: [[], [], [], [], [], [], [],  [], [], [], [], [], [],  []],
        vendrediAm: [[], 'fixe', [], [], [], [], [],  [], [], [], [], [], [],  []],
        vendrediPm: [[], 'fixe', [], [], [], [], [],  [], [], [], [], [], [],  []],
      },
      jour: ['lundiAm', 'lundiPm', 'mardiAm', 'mardiPm', 'mercrediAm', 'mercrediPm', 'jeudiAm', 'jeudiPm', 'vendrediAm', 'vendrediPm'],
      employe: ["nom1", "nom2", "nom3", "nom4", "nom5", "nom6", "nom7", "nom8", "nom9", "nom10", "nom11", "nom12", "nom13", "nom14"]

    }
  },
  methods: {
    generatePlanning() {

/**

var emptyTableCell = test.length - test.filter(String).length;

 */

      this.planningDays = {
        lundiAm: [, , , , , , , 'fixe', , , , , , 'fixe'],
        lundiPm: [, , , , , , , 'fixe', , , , , , 'fixe'],
        mardiAm: [, , , , , , , , , 'fixe', , , , 'fixe'],
        mardiPm: [, , , , , , , , , 'fixe', , , , 'fixe'],
        mercrediAm: [, , , 'fixe', , 'fixe', 'fixe', , , , , 'fixe'],
        mercrediPm: [, , , 'fixe', , 'fixe', 'fixe', , , , , 'fixe'],
        jeudiAm: [],
        jeudiPm: [],
        vendrediAm: [, 'fixe'],
        vendrediPm: [, 'fixe']
      }


      for (let t in this.planningDays) {
        for (let u = 0; u < 14; u++) {
          document.getElementsByClassName(t)[u].innerHTML = ""
          document.getElementsByClassName(t)[u].className = t
        }
      }

      for (let i in this.addTaskRules) {
        for (let j in this.addTaskRules[i].jour) {
          for (let k in this.addTaskRules[i].jour[j]) {

            if (k == "checked" && this.addTaskRules[i].jour[j][k]) {

              for (let l = 0; l < this.addTaskRules[i].jour[j]["nbrAm"]; l++) {
                for (let z in this.planningDays) {
                  if (z == j + 'Am') {
                    console.log(this.planningDays[z].length - this.planningDays[z].filter(String).length)
                    if (this.addTaskRules[i]['employes'][0] == 'tous') {
                      let randomWorker = Math.floor(Math.random() * (14 - 0) + 0)
                      while (undefined != this.planningDays[z][randomWorker]) {
                        randomWorker = Math.floor(Math.random() * (14 - 0) + 0)

                      }
                      this.planningDays[z][randomWorker] = this.addTaskRules[i]['nom']
                      this.planningColors[z][randomWorker] = this.addTaskRules[i]['color']
                    } else {
                      let employes = []
                      for (let a of this.addTaskRules[i]['employes']) {
                        employes.push(this.employe.indexOf(a))
                      }
                      let randomWorker = Math.floor(Math.random() * (employes.length - 0) + 0)

                      while (undefined != this.planningDays[z][employes[randomWorker]]) {
                        randomWorker = Math.floor(Math.random() * (employes.length - 0) + 0)

                      }
                      this.planningDays[z][employes[randomWorker]] = this.addTaskRules[i]['nom']
                      this.planningColors[z][employes[randomWorker]] = this.addTaskRules[i]['color']

                    }

                  }
                }
              }

              for (let l = 0; l < this.addTaskRules[i].jour[j]["nbrPm"]; l++) {
                for (let z in this.planningDays) {
                  if (z == j + 'Pm') {
                    console.log(this.planningDays[z].length - this.planningDays[z].filter(String).length)

                    if (this.addTaskRules[i]['employes'][0] == 'tous') {
                      let randomWorker = Math.floor(Math.random() * (14 - 0) + 0)
                      while (undefined != this.planningDays[z][randomWorker]) {
                        randomWorker = Math.floor(Math.random() * (14 - 0) + 0)

                      }
                      this.planningDays[z][randomWorker] = this.addTaskRules[i]['nom']
                      this.planningColors[z][randomWorker] = this.addTaskRules[i]['color']
                    } else {
                      let employes = []
                      for (let a of this.addTaskRules[i]['employes']) {
                        employes.push(this.employe.indexOf(a))
                      }
                      let randomWorker = Math.floor(Math.random() * (employes.length - 0) + 0)

                      while (undefined != this.planningDays[z][employes[randomWorker]]) {
                        randomWorker = Math.floor(Math.random() * (employes.length - 0) + 0)

                      }
                      this.planningDays[z][employes[randomWorker]] = this.addTaskRules[i]['nom']
                      this.planningColors[z][employes[randomWorker]] = this.addTaskRules[i]['color']
                    }
                  }
                }
              }



            }
          }
        }
      }

      for (let t in this.planningDays) {
        for (let u = 0; u < 14; u++) {
          if (!this.planningDays[t][u]) {

            document.getElementsByClassName(t)[u].innerHTML = ""
            document.getElementsByClassName(t)[u].style = "border:1px solid #000 !important;"
            document.getElementsByClassName(t)[u].style += "background-color: #fff;"
          } else {
            document.getElementsByClassName(t)[u].innerHTML = this.planningDays[t][u]
            document.getElementsByClassName(t)[u].style = "background-color:" + this.planningColors[t][u]

            document.getElementsByClassName(t)[u].className += " " + this.planningDays[t][u]
          }

        }
      }
    },
    deletePlanning() {
      this.planningDays = {
        lundiAm: [],
        lundiPm: [],
        mardiAm: [],
        mardiPm: [],
        mercrediAm: [],
        mercrediPm: [],
        jeudiAm: [],
        jeudiPm: [],
        vendrediAm: [],
        vendrediPm: []
      }

      for (let t in this.planningDays) {
        for (let u = 0; u < 14; u++) {
          document.getElementsByClassName(t)[u].innerHTML = ""
          document.getElementsByClassName(t)[u].className = t
          document.getElementsByClassName(t)[u].style = "border:1px solid #000 !important;"
            document.getElementsByClassName(t)[u].style += "background-color: #fff;"
        }
      }
    },
    updateparent(variable) {
      this.addTaskRules.push({
        nom: variable.nom,
        jour: {
          lundi: {
            checked: variable.jour1.lundi.checked,
            nbrAm: variable.jour1.lundi.nbrAm,
            nbrPm: variable.jour1.lundi.nbrPm
          },
          mardi: {
            checked: variable.jour1.mardi.checked,
            nbrAm: variable.jour1.mardi.nbrAm,
            nbrPm: variable.jour1.mardi.nbrPm
          },
          mercredi: {
            checked: variable.jour1.mercredi.checked,
            nbrAm: variable.jour1.mercredi.nbrAm,
            nbrPm: variable.jour1.mercredi.nbrPm
          },
          jeudi: {
            checked: variable.jour1.jeudi.checked,
            nbrAm: variable.jour1.jeudi.nbrAm,
            nbrPm: variable.jour1.jeudi.nbrPm
          },
          vendredi: {
            checked: variable.jour1.vendredi.checked,
            nbrAm: variable.jour1.vendredi.nbrAm,
            nbrPm: variable.jour1.vendredi.nbrPm
          },
        },
        employes: variable.employes,
        color: variable.color
      })
    },
    displayForm() {
      this.formActive = !this.formActive
    },
    deleteRule(name){
      const found = this.addTaskRules.find(element => element.nom == name);
      this.addTaskRules.splice(this.addTaskRules.indexOf(found), 1)
    },
    saveRules(){
      
      JSON.parse
      localStorage.setItem("rules",JSON.stringify(this.addTaskRules));
      console.log(JSON.parse(localStorage.getItem("rules")))
    }

  },
  computed: {

  }

}
</script>
<style lang="">

</style>